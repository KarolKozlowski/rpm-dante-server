name: RPM Build
on: push

env:
  dante_version: "1.4.3"

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Download Dante sources
      run: wget https://www.inet.no/dante/files/dante-${dante_version}.tar.gz -O dante-${dante_version}.tar.gz
      shell: bash      

    - name: Extract Dante sources
      run: tar --strip-components=1 -xf dante-${dante_version}.tar.gz
      shell: bash      

    - uses: docker://perconalab/rpmbuild:latest

    - name: Build RPM package
      run: "rpmbuild --define '%_hardening_ldflags -Wl,-z,now' --define '_extraflags #' -ba SPECS/dante.spec"
      shell: bash

    # - name: Upload artifact
    #   uses: actions/upload-artifact@v1.0.0
    #   with:
    #     name: Binary RPM
    #     path: ${{ steps.rpm.outputs.rpm_dir_path }}
